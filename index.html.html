<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ† - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; color: white; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        input[type="number"] { background: #1e293b; color: #fbbf24; border: none; text-align: center; font-weight: 900; border-radius: 8px; width: 45px; height: 35px; }
        input:disabled { opacity: 0.5; cursor: not-allowed; }
        .step-box { border-right: 4px solid #fbbf24; padding-right: 10px; }
    </style>
</head>
<body class="p-3 pb-20">
    <div class="max-w-md mx-auto space-y-4">
        
        <div class="flex justify-around items-center py-3 glass rounded-2xl border-b-2 border-amber-500 shadow-xl">
            <div id="hist-Ø£Ø­Ù…Ø¯" class="text-center"><p class="text-[10px] text-slate-400">Ø£Ø­Ù…Ø¯</p><p class="text-xl font-black text-amber-500">0</p></div>
            <div id="hist-Ù…Ø´Ø¹Ù„" class="text-center"><p class="text-[10px] text-slate-400">Ù…Ø´Ø¹Ù„</p><p class="text-xl font-black text-amber-500">0</p></div>
            <div id="hist-ÙÙŠØµÙ„" class="text-center"><p class="text-[10px] text-slate-400">ÙÙŠØµÙ„</p><p class="text-xl font-black text-amber-500">0</p></div>
        </div>

        <div id="contentArea" class="space-y-4">
            <div class="glass rounded-2xl overflow-hidden shadow-lg">
                <table class="w-full text-xs text-center">
                    <thead class="bg-white/10 text-amber-400">
                        <tr><th class="p-3 text-right">Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th class="p-3">Ù„Ø¹Ø¨</th><th class="p-3 font-black">Ù†Ù‚Ø§Ø·</th></tr>
                    </thead>
                    <tbody id="leagueBody" class="divide-y divide-white/5 font-bold"></tbody>
                </table>
            </div>

            <div id="matchesList" class="space-y-2"></div>

            <div id="playoffZone" class="hidden p-4 glass rounded-3xl border-2 border-indigo-500 bg-indigo-500/5 space-y-4">
                <div class="step-box">
                    <h3 class="text-indigo-400 font-black text-xs">1. Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„Ù…Ù„Ø­Ù‚ (2 Ø¶Ø¯ 3)</h3>
                    <div class="flex items-center gap-3 mt-2">
                        <span id="p2Name" class="text-xs font-bold"></span>
                        <input type="number" id="pScore1" oninput="runLogic()">
                        <span>Ã—</span>
                        <input type="number" id="pScore2" oninput="runLogic()">
                        <span id="p3Name" class="text-xs font-bold text-left"></span>
                    </div>
                </div>

                <div id="finalZone" class="hidden step-box border-amber-500">
                    <h3 class="text-amber-500 font-black text-xs">2. Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø§Ù„ÙƒØ¨ÙŠØ± ğŸ‘‘</h3>
                    <div class="flex items-center gap-3 mt-2">
                        <span id="p1Name" class="text-xs font-black text-amber-400"></span>
                        <input type="number" id="fScore1" class="border-2 border-amber-500" oninput="runLogic()">
                        <span>Ã—</span>
                        <input type="number" id="fScore2" class="border-2 border-amber-500" oninput="runLogic()">
                        <span id="pWinPlayoff" class="text-xs font-bold">ØŸ</span>
                    </div>
                </div>
            </div>
            
            <div id="archiveBtnArea" class="pt-4">
                <button onclick="showArchive()" class="w-full py-2 text-xs text-slate-500 underline">Ø¹Ø±Ø¶ Ø£Ø±Ø´ÙŠÙ Ø§Ù„Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</button>
            </div>
        </div>
    </div>

<script>
    let players = JSON.parse(localStorage.getItem('players')) || { "Ø£Ø­Ù…Ø¯": { history: 0 }, "Ù…Ø´Ø¹Ù„": { history: 0 }, "ÙÙŠØµÙ„": { history: 0 } };
    let seasons = JSON.parse(localStorage.getItem('seasons')) || [];
    const matchesArr = [["Ø£Ø­Ù…Ø¯","Ù…Ø´Ø¹Ù„"],["Ù…Ø´Ø¹Ù„","ÙÙŠØµÙ„"],["ÙÙŠØµÙ„","Ø£Ø­Ù…Ø¯"],["Ù…Ø´Ø¹Ù„","Ø£Ø­Ù…Ø¯"],["ÙÙŠØµÙ„","Ù…Ø´Ø¹Ù„"],["Ø£Ø­Ù…Ø¯","ÙÙŠØµÙ„"]];

    function setup() {
        let h = '';
        matchesArr.forEach((m, i) => {
            h += `<div class="glass p-3 rounded-xl flex items-center justify-between">
                <span class="w-16 font-bold text-slate-300 text-xs">${m[0]}</span>
                <div class="flex items-center gap-2">
                    <input type="number" class="l-in" oninput="runLogic()">
                    <span class="text-slate-600">Ã—</span>
                    <input type="number" class="l-in" oninput="runLogic()">
                </div>
                <span class="w-16 text-left font-bold text-slate-300 text-xs">${m[1]}</span>
            </div>`;
        });
        document.getElementById('matchesList').innerHTML = h;
        updateUI();
    }

    function runLogic() {
        let stats = { "Ø£Ø­Ù…Ø¯": {pts:0, pld:0, diff:0}, "Ù…Ø´Ø¹Ù„": {pts:0, pld:0, diff:0}, "ÙÙŠØµÙ„": {pts:0, pld:0, diff:0} };
        const ins = document.querySelectorAll('.l-in');
        let done = 0;
        
        matchesArr.forEach((m, i) => {
            let g1 = parseInt(ins[i*2].value), g2 = parseInt(ins[i*2+1].value);
            if (!isNaN(g1) && !isNaN(g2)) {
                done++; stats[m[0]].pld++; stats[m[1]].pld++;
                stats[m[0]].diff += (g1-g2); stats[m[1]].diff += (g2-g1);
                if(g1 > g2) stats[m[0]].pts+=3; else if(g2 > g1) stats[m[1]].pts+=3; else {stats[m[0]].pts+=1; stats[m[1]].pts+=1;}
            }
        });

        let sorted = Object.keys(stats).sort((a,b) => stats[b].pts - stats[a].pts || stats[b].diff - stats[a].diff);
        renderTable(sorted, stats);

        // Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ù„Ø­Ù‚ ÙˆØ§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        if(done === 6) {
            document.getElementById('playoffZone').classList.remove('hidden');
            document.getElementById('p2Name').innerText = sorted[1];
            document.getElementById('p3Name').innerText = sorted[2];
            document.getElementById('p1Name').innerText = sorted[0];

            let ps1 = parseInt(document.getElementById('pScore1').value);
            let ps2 = parseInt(document.getElementById('pScore2').value);
            let winP = "";

            if(!isNaN(ps1) && !isNaN(ps2)) {
                winP = ps1 > ps2 ? sorted[1] : sorted[2];
                document.getElementById('pWinPlayoff').innerText = winP;
                document.getElementById('finalZone').classList.remove('hidden');
            } else {
                document.getElementById('finalZone').classList.add('hidden');
            }

            let fs1 = parseInt(document.getElementById('fScore1').value);
            let fs2 = parseInt(document.getElementById('fScore2').value);
            if(!isNaN(fs1) && !isNaN(fs2) && winP !== "") {
                let absoluteWinner = fs1 > fs2 ? sorted[0] : winP;
                setTimeout(() => { finishSeason(absoluteWinner); }, 600);
            }
        } else {
            document.getElementById('playoffZone').classList.add('hidden');
        }
    }

    function finishSeason(winner) {
        let seasonData = {
            id: seasons.length + 1,
            winner: winner,
            scores: Array.from(document.querySelectorAll('input')).map(i => i.value)
        };
        seasons.push(seasonData);
        players[winner].history++;
        localStorage.setItem('seasons', JSON.stringify(seasons));
        localStorage.setItem('players', JSON.stringify(players));
        alert("ğŸ‰ Ø§Ù„Ø¨Ø·Ù„ Ù‡Ùˆ " + winner + "! ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ù…ÙˆØ³Ù… ÙˆØ§Ù„Ø£Ø±Ø´ÙØ©.");
        location.reload();
    }

    function renderTable(sorted, stats) {
        let h = '';
        sorted.forEach(n => {
            h += `<tr><td class="p-3 text-right border-r-4 border-amber-500">${n}</td><td class="p-3">${stats[n].pld}</td><td class="p-3 text-indigo-400 font-black">${stats[n].pts}</td></tr>`;
            document.querySelector(`#hist-${n} p:last-child`).innerText = players[n].history;
        });
        document.getElementById('leagueBody').innerHTML = h;
    }

    function showArchive() {
        let h = '<button onclick="location.reload()" class="text-xs text-amber-500 mb-4 underline">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</button><div class="space-y-3">';
        seasons.slice().reverse().forEach(s => {
            h += `<div class="glass p-4 rounded-2xl opacity-70">
                <div class="flex justify-between text-xs mb-2"><span>Ù…ÙˆØ³Ù… #${s.id}</span><span class="font-black text-amber-500">Ø§Ù„Ø¨Ø·Ù„: ${s.winner}</span></div>
                <div class="flex flex-wrap gap-1 pointer-events-none">
                    ${s.scores.map(sc => `<span class="bg-white/10 px-2 py-1 rounded text-[10px]">${sc || 0}</span>`).join('')}
                </div>
            </div>`;
        });
        document.getElementById('contentArea').innerHTML = h + (seasons.length? '':'<p class="text-center text-xs">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø±Ø´ÙŠÙ</p>') + '</div>';
    }

    setup();
</script>
</body>
</html>
