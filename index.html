<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø«Ù„Ø§Ø«Ø© - Ù…Ø¨Ø§Ø´Ø±</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #3b82f6; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --success: #10b981; }
        body { background-color: var(--bg); color: var(--text); font-family: 'Tajawal', sans-serif; margin: 0; padding: 15px; }
        .card { background: var(--card); border-radius: 16px; padding: 18px; margin-bottom: 15px; border: 1px solid #334155; }
        h2 { text-align: center; color: var(--primary); }
        .match-row { display: flex; align-items: center; justify-content: space-between; background: #0f172a; padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #1e293b; gap: 5px; }
        .score-input { width: 45px; height: 45px; text-align: center; background: #1e293b; color: white; border: 2px solid #3b82f6; border-radius: 8px; font-size: 1.2rem; font-weight: bold; }
        .btn-update { background: var(--success); color: white; border: none; padding: 8px; border-radius: 8px; cursor: pointer; font-size: 0.8rem; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; text-align: center; }
        th { color: #94a3b8; font-size: 0.8rem; padding: 10px; border-bottom: 1px solid #334155; }
        td { padding: 12px 5px; border-bottom: 1px solid #334155; font-weight: bold; }
        .loading-screen { text-align: center; margin-top: 50px; color: var(--primary); }
    </style>
</head>
<body>

    <div id="loading" class="loading-screen">ğŸ”„ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...</div>

    <div id="main-content" style="display:none;">
        <h2>ğŸ† Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h2>
        
        <div class="card">
            <h3 style="text-align:center; margin-top:0;">ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨</h3>
            <table id="leagueTable">
                <thead><tr><th>Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ù„Ø¹Ø¨</th><th>+/-</th><th>Ù†Ù‚Ø§Ø·</th></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="card">
            <h3 style="text-align:center; margin-top:0;">âš½ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
            <p style="text-align:center; font-size:0.7rem; color:#94a3b8;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø§Ù„Ø£Ø®Ø¶Ø± Ø¨Ø¹Ø¯ ÙƒÙ„ ØªØ¹Ø¯ÙŠÙ„</p>
            <div id="matchesList"></div>
        </div>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyA_s2HoKKxwXELNHEmti_RsvA_nP6fmWP8",
        authDomain: "nhffbjhh.firebaseapp.com",
        databaseURL: "https://nhffbjhh-default-rtdb.firebaseio.com",
        projectId: "nhffbjhh",
        storageBucket: "nhffbjhh.firebasestorage.app",
        messagingSenderId: "779073349880",
        appId: "1:779073349880:web:9cd7adb0ed3c628546b30d"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database().ref('league_v1');

    db.on('value', (snapshot) => {
        const data = snapshot.val() || {
            matches: [
                {h: "Ø£Ø­Ù…Ø¯", a: "Ù…Ø´Ø¹Ù„", sh: "", sa: ""}, {h: "Ù…Ø´Ø¹Ù„", a: "ÙÙŠØµÙ„", sh: "", sa: ""},
                {h: "ÙÙŠØµÙ„", a: "Ø£Ø­Ù…Ø¯", sh: "", sa: ""}, {h: "Ù…Ø´Ø¹Ù„", a: "Ø£Ø­Ù…Ø¯", sh: "", sa: ""},
                {h: "ÙÙŠØµÙ„", a: "Ù…Ø´Ø¹Ù„", sh: "", sa: ""}, {h: "Ø£Ø­Ù…Ø¯", a: "ÙÙŠØµÙ„", sh: "", sa: ""}
            ]
        };
        render(data);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
    });

    function render(data) {
        let stats = {"Ø£Ø­Ù…Ø¯":{p:0,pts:0,gd:0}, "Ù…Ø´Ø¹Ù„":{p:0,pts:0,gd:0}, "ÙÙŠØµÙ„":{p:0,pts:0,gd:0}};
        let mHtml = "";

        data.matches.forEach((m, i) => {
            if(m.sh !== "" && m.sa !== "") {
                let sH = parseInt(m.sh), sA = parseInt(m.sa);
                stats[m.h].p++; stats[m.a].p++;
                stats[m.h].gd += (sH - sA); stats[m.a].gd += (sA - sH);
                if(sH > sA) stats[m.h].pts += 3;
                else if(sA > sH) stats[m.a].pts += 3;
                else { stats[m.h].pts++; stats[m.a].pts++; }
            }
            mHtml += `
                <div class="match-row">
                    <span style="width:25%">${m.h}</span>
                    <input type="number" id="sh${i}" value="${m.sh}" class="score-input">
                    <span>:</span>
                    <input type="number" id="sa${i}" value="${m.sa}" class="score-input">
                    <span style="width:25%; text-align:left;">${m.a}</span>
                    <button class="btn-update" onclick="manualUpdate(${i})">ØªØ­Ø¯ÙŠØ«</button>
                </div>`;
        });

        document.getElementById('matchesList').innerHTML = mHtml;
        const sorted = ["Ø£Ø­Ù…Ø¯", "Ù…Ø´Ø¹Ù„", "ÙÙŠØµÙ„"].sort((a,b) => stats[b].pts - stats[a].pts || stats[b].gd - stats[a].gd);
        document.querySelector("#leagueTable tbody").innerHTML = sorted.map(n => `
            <tr><td>${n}</td><td>${stats[n].p}</td><td>${stats[n].gd}</td><td style="color:var(--primary)">${stats[n].pts}</td></tr>
        `).join("");
    }

    function manualUpdate(i) {
        const valH = document.getElementById(`sh${i}`).value;
        const valA = document.getElementById(`sa${i}`).value;
        db.child('matches').child(i).update({ sh: valH, sa: valA })
        .then(() => alert("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­ âœ…"))
        .catch((e) => alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ âŒ"));
    }
</script>
</body>
</html>
