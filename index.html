<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù…Ø­ØªØ±ÙÙŠÙ† - Ù†Ø¸Ø§Ù… Ø§Ù„Ù‚ÙÙ„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Cairo', sans-serif; background-color: #0f172a; color: white; }
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); }
        input[type="number"] { background: #1e293b; color: #fbbf24; border: none; text-align: center; font-weight: 900; border-radius: 8px; width: 45px; height: 35px; }
        input:disabled { opacity: 0.5; color: #94a3b8; background: #0f172a; border: 1px solid rgba(255,255,255,0.1); }
        .tab-active { border-bottom: 3px solid #fbbf24; color: #fbbf24; }
    </style>
</head>
<body class="p-3 pb-20">
    <div class="max-w-md mx-auto space-y-4">
        
        <div class="flex justify-around border-b border-white/10 mb-4 font-bold text-sm">
            <button onclick="location.reload()" class="pb-2 tab-active w-1/2">Ø§Ù„Ù…ÙˆØ³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
            <button onclick="showArchive()" class="pb-2 w-1/2 text-slate-500">Ø§Ù„Ø£Ø±Ø´ÙŠÙ</button>
        </div>

        <div id="contentArea">
            <div id="mainUI" class="space-y-4">
                <div class="flex justify-around items-center py-3 glass rounded-2xl border-b-2 border-amber-500">
                    <div id="hist-Ø£Ø­Ù…Ø¯" class="text-center"><p class="text-[10px] text-slate-400">Ø£Ø­Ù…Ø¯</p><p class="text-xl font-black text-amber-500">0</p></div>
                    <div id="hist-Ù…Ø´Ø¹Ù„" class="text-center"><p class="text-[10px] text-slate-400">Ù…Ø´Ø¹Ù„</p><p class="text-xl font-black text-amber-500">0</p></div>
                    <div id="hist-ÙÙŠØµÙ„" class="text-center"><p class="text-[10px] text-slate-400">ÙÙŠØµÙ„</p><p class="text-xl font-black text-amber-500">0</p></div>
                </div>

                <div class="glass rounded-2xl overflow-hidden shadow-2xl">
                    <table class="w-full text-xs text-center">
                        <thead class="bg-white/10 text-amber-400">
                            <tr><th class="p-3 text-right">Ø§Ù„Ù„Ø§Ø¹Ø¨</th><th class="p-3">Ù„Ø¹Ø¨</th><th class="p-3">Ù†Ù‚Ø§Ø·</th></tr>
                        </thead>
                        <tbody id="leagueBody" class="divide-y divide-white/5 font-bold text-slate-200"></tbody>
                    </table>
                </div>

                <div id="matchesList" class="space-y-2"></div>

                <div id="finalZone" class="hidden p-4 glass rounded-3xl border-2 border-amber-500 bg-amber-500/5 space-y-3 text-center">
                    <h3 class="text-amber-500 font-black text-xs">ğŸ† Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ (ØªØºÙ„Ù‚ Ø§Ù„Ù…ÙˆØ³Ù…)</h3>
                    <div class="flex items-center justify-center gap-4">
                        <span id="finalistName" class="font-black text-amber-400"></span>
                        <input type="number" id="fScore1" class="w-12 h-10 text-lg border-2 border-amber-500" oninput="checkFinalAuto()">
                        <span class="text-slate-500">VS</span>
                        <input type="number" id="fScore2" class="w-12 h-10 text-lg border-2 border-amber-500" oninput="checkFinalAuto()">
                        <span id="finalistPlayoff" class="font-bold">ØŸ</span>
                    </div>
                    <p class="text-[9px] text-slate-500 italic">Ø¨Ù…Ø¬Ø±Ø¯ ÙˆØ¶Ø¹ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŒ Ø³ÙŠØªÙ… Ù‚ÙÙ„ Ø§Ù„Ù…ÙˆØ³Ù… Ù„Ù„Ø£Ø¨Ø¯</p>
                </div>
            </div>
        </div>
    </div>

<script>
    let players = JSON.parse(localStorage.getItem('players')) || { "Ø£Ø­Ù…Ø¯": { history: 0 }, "Ù…Ø´Ø¹Ù„": { history: 0 }, "ÙÙŠØµÙ„": { history: 0 } };
    let seasons = JSON.parse(localStorage.getItem('seasons')) || [];
    const teamOrder = ["Ø£Ø­Ù…Ø¯", "Ù…Ø´Ø¹Ù„", "ÙÙŠØµÙ„"];
    const matchesArr = [["Ø£Ø­Ù…Ø¯","Ù…Ø´Ø¹Ù„"],["Ù…Ø´Ø¹Ù„","ÙÙŠØµÙ„"],["ÙÙŠØµÙ„","Ø£Ø­Ù…Ø¯"],["Ù…Ø´Ø¹Ù„","Ø£Ø­Ù…Ø¯"],["ÙÙŠØµÙ„","Ù…Ø´Ø¹Ù„"],["Ø£Ø­Ù…Ø¯","ÙÙŠØµÙ„"]];

    function setupMain() {
        let h = '';
        matchesArr.forEach((m, i) => {
            h += `<div class="glass p-3 rounded-xl flex items-center justify-between">
                <span class="w-16 font-bold text-slate-300 text-xs">${m[0]}</span>
                <div class="flex items-center gap-2">
                    <input type="number" class="l-in" data-idx="${i*2}" oninput="calc()">
                    <span class="text-slate-600">Ã—</span>
                    <input type="number" class="l-in" data-idx="${i*2+1}" oninput="calc()">
                </div>
                <span class="w-16 text-left font-bold text-slate-300 text-xs">${m[1]}</span>
            </div>`;
        });
        document.getElementById('matchesList').innerHTML = h;
        updateHist();
        calc();
    }

    function calc() {
        let stats = { "Ø£Ø­Ù…Ø¯": {pts:0, pld:0, diff:0}, "Ù…Ø´Ø¹Ù„": {pts:0, pld:0, diff:0}, "ÙÙŠØµÙ„": {pts:0, pld:0, diff:0} };
        const ins = document.querySelectorAll('.l-in');
        let done = 0;
        matchesArr.forEach((m, i) => {
            let g1 = parseInt(ins[i*2].value), g2 = parseInt(ins[i*2+1].value);
            if (!isNaN(g1) && !isNaN(g2)) {
                done++; stats[m[0]].pld++; stats[m[1]].pld++;
                stats[m[0]].diff += (g1-g2); stats[m[1]].diff += (g2-g1);
                if(g1 > g2) stats[m[0]].pts+=3; else if(g2 > g1) stats[m[1]].pts+=3; else {stats[m[0]].pts+=1; stats[m[1]].pts+=1;}
            }
        });
        let sorted = Object.keys(stats).sort((a,b) => stats[b].pts - stats[a].pts || stats[b].diff - stats[a].diff);
        renderTable(sorted, stats);
        
        if(done === 6) {
            document.getElementById('finalZone').classList.remove('hidden');
            document.getElementById('finalistName').innerText = sorted[0];
            document.getElementById('finalistPlayoff').innerText = "ÙØ§Ø¦Ø² Ø§Ù„Ù…Ù„Ø­Ù‚";
        }
    }

    function renderTable(sorted, stats) {
        let h = '';
        sorted.forEach(n => {
            h += `<tr><td class="p-3 text-right border-r-4 border-amber-500">${n}</td><td class="p-3">${stats[n].pld}</td><td class="p-3 text-indigo-400 font-black">${stats[n].pts}</td></tr>`;
        });
        document.getElementById('leagueBody').innerHTML = h;
    }

    function checkFinalAuto() {
        let s1 = parseInt(document.getElementById('fScore1').value);
        let s2 = parseInt(document.getElementById('fScore2').value);
        if(!isNaN(s1) && !isNaN(s2)) {
            let winner = s1 > s2 ? document.getElementById('finalistName').innerText : prompt("Ù…Ù† Ø§Ù„ÙØ§Ø¦Ø² Ù…Ù† Ø§Ù„Ù…Ù„Ø­Ù‚ Ø§Ù„Ø°ÙŠ Ø§Ù†ØªØµØ± ÙÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØŸ");
            if(players[winner]) {
                saveAndLock(winner);
            }
        }
    }

    function saveAndLock(winner) {
        let season = {
            id: seasons.length + 1,
            winner: winner,
            scores: Array.from(document.querySelectorAll('.l-in')).map(i => i.value),
            final: [document.getElementById('fScore1').value, document.getElementById('fScore2').value]
        };
        seasons.push(season);
        players[winner].history++;
        localStorage.setItem('seasons', JSON.stringify(seasons));
        localStorage.setItem('players', JSON.stringify(players));
        alert("ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ù…ÙˆØ³Ù… Ø¨Ù†Ø¬Ø§Ø­!");
        location.reload();
    }

    function showArchive() {
        let h = '<h2 class="text-center font-black text-amber-500 mb-4 text-sm tracking-widest">Ø§Ù„Ù…ÙˆØ§Ø³Ù… Ø§Ù„Ù…Ù‚ÙÙ„Ø© (Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)</h2><div class="space-y-3">';
        seasons.slice().reverse().forEach(s => {
            h += `<div class="glass p-4 rounded-2xl border-r-4 border-slate-500 opacity-80">
                <div class="flex justify-between items-center mb-2">
                    <span class="font-black text-xs">Ù…ÙˆØ³Ù… #${s.id}</span>
                    <span class="bg-amber-500 text-slate-900 px-2 py-1 rounded text-[10px] font-black">Ø§Ù„Ø¨Ø·Ù„: ${s.winner}</span>
                </div>
                <div class="grid grid-cols-3 gap-1 opacity-50 pointer-events-none scale-90">
                    ${s.scores.map(sc => `<input type="number" value="${sc}" disabled class="w-8 h-6 text-[10px]">`).join('')}
                </div>
            </div>`;
        });
        document.getElementById('contentArea').innerHTML = h + '</div>';
    }

    function updateHist() {
        teamOrder.forEach(n => {
            document.querySelector(`#hist-${n} p:last-child`).innerText = players[n].history;
        });
    }

    setupMain();
</script>
</body>
</html>
