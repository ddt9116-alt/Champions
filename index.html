<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø«Ù„Ø§Ø«Ø© - Ø¨Ø« Ù…Ø¨Ø§Ø´Ø±</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #3b82f6; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --gold: #eab308; }
        * { box-sizing: border-box; font-family: 'Tajawal', sans-serif; }
        body { background-color: var(--bg); color: var(--text); margin: 0; padding: 15px; padding-bottom: 50px; }
        .container { max-width: 500px; margin: auto; }
        .card { background: var(--card); border-radius: 16px; padding: 18px; margin-bottom: 15px; border: 1px solid #334155; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        h2, h3 { text-align: center; margin-top: 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { color: #94a3b8; font-size: 0.8rem; padding: 10px; border-bottom: 1px solid #334155; }
        td { padding: 12px 8px; border-bottom: 1px solid #334155; text-align: center; font-weight: bold; }
        .match-row { display: flex; align-items: center; justify-content: space-between; background: #0f172a; padding: 12px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #1e293b; }
        .score-input { width: 50px; height: 50px; text-align: center; background: #1e293b; color: white; border: 2px solid #3b82f6; border-radius: 10px; font-size: 1.3rem; font-weight: 900; }
        .team-name { width: 30%; font-size: 0.95rem; font-weight: 700; }
        .pts-highlight { color: var(--primary); font-size: 1.1rem; }
        #loading { text-align: center; padding: 20px; color: var(--primary); font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h2 style="color: var(--primary);">ğŸ† Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø«Ù„Ø§Ø«Ø© - Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h2>
    
    <div id="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ù…Ø¹ Ø§Ù„Ø³Ø­Ø§Ø¨Ø©...</div>

    <div id="main-content" style="display: none;">
        <div class="card">
            <h3>ğŸ“Š Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨</h3>
            <table id="leagueTable">
                <thead>
                    <tr><th>Ø§Ù„ÙØ±ÙŠÙ‚</th><th>Ù„Ø¹Ø¨</th><th>+/-</th><th>Ù†Ù‚Ø§Ø·</th></tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>

        <div class="card">
            <h3>âš½ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</h3>
            <div id="matchesArea"></div>
        </div>
    </div>
</div>

<script>
    // Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø§Ù„Ø®Ø§ØµØ© Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§ (ØªÙ… Ø¶Ø¨Ø·Ù‡Ø§ Ù„ØªØ¹Ù…Ù„ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­)
    const firebaseConfig = {
        apiKey: "AIzaSyA_s2HoKKxwXELNHEmti_RsvA_nP6fmWP8",
        authDomain: "nhffbjhh.firebaseapp.com",
        databaseURL: "https://nhffbjhh-default-rtdb.firebaseio.com",
        projectId: "nhffbjhh",
        storageBucket: "nhffbjhh.firebasestorage.app",
        messagingSenderId: "779073349880",
        appId: "1:779073349880:web:9cd7adb0ed3c628546b30d"
    };

    // Ø¨Ø¯Ø¡ ØªØ´ØºÙŠÙ„ Firebase
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.database().ref('my_live_league');

    // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    const players = ["Ø£Ø­Ù…Ø¯", "Ù…Ø´Ø¹Ù„", "ÙÙŠØµÙ„"];

    // Ø§Ù„Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª ÙÙŠ Ø­Ø§Ù„ ÙƒØ§Ù†Øª Ø§Ù„Ù‚Ø§Ø¹Ø¯Ø© ÙØ§Ø±ØºØ©
    const initialData = {
        matches: [
            {h: "Ø£Ø­Ù…Ø¯", a: "Ù…Ø´Ø¹Ù„", sh: "", sa: ""}, {h: "Ù…Ø´Ø¹Ù„", a: "ÙÙŠØµÙ„", sh: "", sa: ""},
            {h: "ÙÙŠØµÙ„", a: "Ø£Ø­Ù…Ø¯", sh: "", sa: ""}, {h: "Ù…Ø´Ø¹Ù„", a: "Ø£Ø­Ù…Ø¯", sh: "", sa: ""},
            {h: "ÙÙŠØµÙ„", a: "Ù…Ø´Ø¹Ù„", sh: "", sa: ""}, {h: "Ø£Ø­Ù…Ø¯", a: "ÙÙŠØµÙ„", sh: "", sa: ""}
        ]
    };

    // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø£ÙŠ ØªØºÙŠÙŠØ± ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø¨Ø§Ø´Ø±)
    db.on('value', (snapshot) => {
        const data = snapshot.val() || initialData;
        updateUI(data);
        document.getElementById('loading').style.display = 'none';
        document.getElementById('main-content').style.display = 'block';
    });

    function updateUI(data) {
        let stats = {"Ø£Ø­Ù…Ø¯":{p:0,pts:0,gd:0}, "Ù…Ø´Ø¹Ù„":{p:0,pts:0,gd:0}, "ÙÙŠØµÙ„":{p:0,pts:0,gd:0}};
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª
        let matchesHtml = "";
        data.matches.forEach((m, i) => {
            if(m.sh !== "" && m.sa !== "") {
                const hS = parseInt(m.sh);
                const aS = parseInt(m.sa);
                stats[m.h].p++; stats[m.a].p++;
                stats[m.h].gd += (hS - aS); stats[m.a].gd += (aS - hS);
                if(hS > aS) stats[m.h].pts += 3;
                else if(aS > hS) stats[m.a].pts += 3;
                else { stats[m.h].pts++; stats[m.a].pts++; }
            }
            matchesHtml += `
                <div class="match-row">
                    <span class="team-name" style="text-align:right;">${m.h}</span>
                    <input type="number" value="${m.sh}" onchange="saveToCloud(${i}, 'sh', this.value)" class="score-input">
                    <span style="font-weight:bold;">:</span>
                    <input type="number" value="${m.sa}" onchange="saveToCloud(${i}, 'sa', this.value)" class="score-input">
                    <span class="team-name" style="text-align:left;">${m.a}</span>
                </div>`;
        });
        document.getElementById('matchesArea').innerHTML = matchesHtml;

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØªØ±ØªÙŠØ¨Ù‡
        const sortedTeams = players.sort((a,b) => stats[b].pts - stats[a].pts || stats[b].gd - stats[a].gd);
        document.querySelector("#leagueTable tbody").innerHTML = sortedTeams.map(name => `
            <tr>
                <td>${name}</td>
                <td>${stats[name].p}</td>
                <td>${stats[name].gd}</td>
                <td class="pts-highlight">${stats[name].pts}</td>
            </tr>
        `).join("");
    }

    // ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨Ø© ÙÙˆØ± ØªØºÙŠÙŠØ± Ø£ÙŠ Ø±Ù‚Ù…
    function saveToCloud(index, side, value) {
        db.child('matches').child(index).update({ [side]: value });
    }
</script>
</body>
</html>
