<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø«Ù„Ø§Ø«ÙŠ - Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ±</title>
    <style>
        :root {
            --bg: #0f172a;
            --card-bg: #1e293b;
            --primary: #3b82f6;
            --success: #10b981;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --border: #334155;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text-main);
            padding: 15px;
            margin: 0;
        }

        .container { max-width: 450px; margin: auto; }

        h2 { text-align: center; color: var(--primary); margin-bottom: 25px; font-weight: 800; }

        /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªØ±ØªÙŠØ¨ */
        .standings-container {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            margin-bottom: 30px;
            border: 1px solid var(--border);
        }

        .standings-table { width: 100%; border-collapse: collapse; text-align: center; }
        .standings-table th { color: var(--text-dim); font-size: 0.75rem; padding-bottom: 12px; border-bottom: 1px solid var(--border); }
        .standings-table td { padding: 12px 5px; font-weight: bold; font-size: 0.95rem; }
        
        .rank-1 { color: #fbbf24; background: rgba(251, 191, 36, 0.1); border-radius: 10px; }

        /* Ø§Ù„Ø¬ÙˆÙ„Ø§Øª ÙˆØ§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª */
        .round-box { margin-bottom: 25px; }
        .match-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 12px;
        }

        .match-row { display: grid; grid-template-columns: 1fr 45px 15px 45px 1fr; align-items: center; gap: 10px; }
        .team-name { font-size: 1rem; font-weight: 600; }
        
        .score-in { 
            width: 45px; height: 40px; 
            background: #0f172a; 
            border: 2px solid var(--border); 
            border-radius: 10px; 
            color: white; 
            text-align: center; 
            font-size: 1.2rem; 
            font-weight: bold;
        }

        .confirm-btn {
            width: 100%;
            margin-top: 12px;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: var(--primary);
            color: white;
            font-weight: bold;
            cursor: pointer;
        }

        /* Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø© Ø§Ù„Ù…Ø¤ÙƒØ¯Ø© */
        .match-card.is-confirmed { border-color: var(--success); background: rgba(16, 185, 129, 0.05); }
        .match-card.is-confirmed .score-in { border-color: var(--success); color: var(--success); }
        .match-card.is-confirmed .confirm-btn { display: none; }
        
        .confirmed-label { display: none; text-align: center; color: var(--success); margin-top: 10px; font-size: 0.8rem; font-weight: bold; }
        .match-card.is-confirmed .confirmed-label { display: block; }

        .btn-new {
            width: 100%; padding: 16px;
            background: linear-gradient(to right, #2563eb, #3b82f6);
            color: white; border: none; border-radius: 15px;
            font-weight: 800; cursor: pointer; margin-top: 10px;
        }
        .btn-new:disabled { opacity: 0.1; cursor: not-allowed; }

        input:disabled { opacity: 1; -webkit-text-fill-color: var(--success); }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ† Ø¯ÙˆØ±ÙŠ Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ± Ø§Ù„Ø£Ø¨Ø¯ÙŠ</h2>
    
    <div class="standings-container">
        <table class="standings-table">
            <thead>
                <tr>
                    <th>Ø§Ù„Ù„Ø§Ø¹Ø¨</th>
                    <th>Ù„Ø¹Ø¨</th>
                    <th>ÙØ§Ø±Ù‚</th>
                    <th>Ù†Ù‚Ø§Ø·</th>
                </tr>
            </thead>
            <tbody id="standings-body"></tbody>
        </table>
    </div>

    <div id="rounds-list"></div>
    <button id="add-round-btn" class="btn-new" onclick="addNewRound()">+ Ø§ÙØªØ­ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
</div>

<script>
    const players = ["Ø£Ø­Ù…Ø¯", "Ù…Ø´Ø¹Ù„", "ÙÙŠØµÙ„"];
    const SECRET_KEY = "ddt";

    function updateLeague() {
        let stats = {};
        players.forEach(p => stats[p] = { played: 0, gf: 0, ga: 0, pts: 0 });

        const allMatchCards = document.querySelectorAll('.match-card');
        let currentRounds = [];
        let currentRoundMatches = [];

        allMatchCards.forEach((card, index) => {
            const s1V = card.querySelector('.s1').value;
            const s2V = card.querySelector('.s2').value;
            const isConfirmed = card.classList.contains('is-confirmed');
            const p1 = card.querySelector('.p1-name').innerText;
            const p2 = card.querySelector('.p2-name').innerText;

            const matchObj = { s1: s1V === "" ? null : parseInt(s1V), s2: s2V === "" ? null : parseInt(s2V), confirmed: isConfirmed };
            currentRoundMatches.push(matchObj);

            if (isConfirmed) {
                const s1 = matchObj.s1; const s2 = matchObj.s2;
                stats[p1].played++; stats[p2].played++;
                stats[p1].gf += s1; stats[p1].ga += s2;
                stats[p2].gf += s2; stats[p2].ga += s1;
                if (s1 > s2) stats[p1].pts += 3;
                else if (s2 > s1) stats[p2].pts += 3;
                else { stats[p1].pts += 1; stats[p2].pts += 1; }
            }

            if ((index + 1) % 3 === 0) {
                currentRounds.push(currentRoundMatches);
                currentRoundMatches = [];
            }
        });

        localStorage.setItem('ultimateLeagueSave', JSON.stringify(currentRounds));
        const lastRoundComplete = currentRounds.length > 0 && currentRounds[currentRounds.length-1].every(m => m.confirmed);
        document.getElementById('add-round-btn').disabled = currentRounds.length > 0 && !lastRoundComplete;

        renderStandings(stats);
    }

    function renderStandings(stats) {
        const sorted = Object.keys(stats).map(name => ({ name, ...stats[name] }))
            .sort((a, b) => b.pts - a.pts || (b.gf - b.ga) - (a.gf - a.ga));
        const tbody = document.getElementById('standings-body');
        tbody.innerHTML = '';
        sorted.forEach((p, i) => {
            tbody.innerHTML += `<tr class="${i===0?'rank-1':''}">
                <td style="text-align:right; padding-right:15px;">${p.name}</td>
                <td>${p.played}</td>
                <td>${p.gf - p.ga}</td>
                <td style="color:var(--primary)">${p.pts}</td>
            </tr>`;
        });
    }

    function confirmWithPass(btn) {
        const card = btn.closest('.match-card');
        const s1 = card.querySelector('.s1').value;
        const s2 = card.querySelector('.score-in.s2').value; // ØªØ¹Ø¯ÙŠÙ„ Ø·ÙÙŠÙ Ù„Ù„Ù…Ø¹Ø±Ù
        
        if (s1 === "" || s2 === "") return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø£ÙˆÙ„Ø§Ù‹!");

        const pass = prompt("Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©:");
        if (pass === SECRET_KEY) {
            card.classList.add('is-confirmed');
            card.querySelectorAll('input').forEach(i => i.disabled = true);
            updateLeague();
        } else {
            alert("Ø®Ø·Ø£! Ù„Ù† ÙŠØªÙ… Ø§Ù„Ø­ÙØ¸.");
        }
    }

    function addNewRound(data = null) {
        const container = document.getElementById('rounds-list');
        const roundNum = container.children.length + 1;
        const div = document.createElement('div');
        div.className = 'round-box';
        
        const mDefs = [{p1: "Ø£Ø­Ù…Ø¯", p2: "Ù…Ø´Ø¹Ù„"}, {p1: "Ù…Ø´Ø¹Ù„", p2: "ÙÙŠØµÙ„"}, {p1: "ÙÙŠØµÙ„", p2: "Ø£Ø­Ù…Ø¯"}];
        let mHTML = '';
        mDefs.forEach((m, i) => {
            const mData = data ? data[i] : null;
            const confirmedClass = mData && mData.confirmed ? 'is-confirmed' : '';
            const disabledAttr = mData && mData.confirmed ? 'disabled' : '';
            mHTML += `
                <div class="match-card ${confirmedClass}">
                    <div class="match-row">
                        <span class="team-name p1-name" style="text-align:left">${m.p1}</span>
                        <input type="number" class="score-in s1" value="${mData?mData.s1:''}" ${disabledAttr} placeholder="0">
                        <span style="color:var(--text-dim)">-</span>
                        <input type="number" class="score-in s2" value="${mData?mData.s2:''}" ${disabledAttr} placeholder="0">
                        <span class="team-name p2-name" style="text-align:right">${m.p2}</span>
                    </div>
                    <button class="confirm-btn" onclick="confirmWithPass(this)">Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
                    <div class="confirmed-label">âœ” Ù…Ø¹ØªÙ…Ø¯Ø©</div>
                </div>`;
        });

        div.innerHTML = `<div style="margin-bottom:10px; font-weight:bold; color:var(--text-dim); border-right:3px solid var(--primary); padding-right:8px;">Ø§Ù„Ø¬ÙˆÙ„Ø© ${roundNum}</div>${mHTML}`;
        container.appendChild(div);
        updateLeague();
    }

    const saved = JSON.parse(localStorage.getItem('ultimateLeagueSave')) || [];
    if(saved.length > 0) saved.forEach(r => addNewRound(r));
    else addNewRound();
</script>
</body>
</html>
